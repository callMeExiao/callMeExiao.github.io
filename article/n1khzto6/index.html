<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.20" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><meta property="og:url" content="https://callmeexiao.baby/article/n1khzto6/"><meta property="og:site_name" content="Exiao's Blog"><meta property="og:title" content="ddd-architecture-blog"><meta property="og:description" content="更新时间：2026-02-08 目标读者：刚接触 DDD、希望看懂本项目分层与术语的人 先说结论（TL;DR） 这个项目是一个 “分层架构 + DDD 思想（部分落地）” 的工程，不是教科书式“纯 DDD”，但已经有很清晰的 DDD 轮廓： 模块上分成 start / adapter / application / domain / infrastru..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2026-02-09T04:43:36.000Z"><meta property="article:modified_time" content="2026-02-09T04:43:36.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ddd-architecture-blog","image":[""],"dateModified":"2026-02-09T04:43:36.000Z","author":[]}</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>ddd-architecture-blog | Exiao's Blog</title><meta name="description" content="更新时间：2026-02-08 目标读者：刚接触 DDD、希望看懂本项目分层与术语的人 先说结论（TL;DR） 这个项目是一个 “分层架构 + DDD 思想（部分落地）” 的工程，不是教科书式“纯 DDD”，但已经有很清晰的 DDD 轮廓： 模块上分成 start / adapter / application / domain / infrastru..."><link rel="preload" href="/assets/style-Cd332rkf.css" as="style"><link rel="stylesheet" href="/assets/style-Cd332rkf.css"><link rel="modulepreload" href="/assets/app-pBrtxVLr.js"><link rel="modulepreload" href="/assets/index.html-5_GaZwt4.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-3bf3774b><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-1afd8ef4></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-1afd8ef4> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-3bf3774b data-v-93076610><div class="vp-navbar" vp-navbar data-v-93076610 data-v-fb9743c7><div class="wrapper" data-v-fb9743c7><div class="container" data-v-fb9743c7><div class="title" data-v-fb9743c7><div class="vp-navbar-title" data-v-fb9743c7 data-v-800466e1><a class="vp-link no-icon link title" href="/" data-v-800466e1 data-v-8fd51d7e><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-c4044e2a><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-c4044e2a><!--]--><!--]--><!--]--><span data-v-800466e1>Exiao&#39;s Blog</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-fb9743c7><div class="content-body" data-v-fb9743c7><!--[--><!--]--><div class="vp-navbar-search search" data-v-fb9743c7><div class="search-wrapper" data-v-9b6231cb><!----><div id="local-search" data-v-9b6231cb><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-9b6231cb><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-fb9743c7 data-v-f0b866c0><span id="main-nav-aria-label" class="visually-hidden" data-v-f0b866c0>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/tags/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>标签</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>归档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-f0b866c0 data-v-c02d6d2b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-c02d6d2b><span class="text" data-v-c02d6d2b><!----><!----><span data-v-c02d6d2b>笔记</span><span class="vpi-chevron-down text-icon" data-v-c02d6d2b></span></span></button><div class="menu" data-v-c02d6d2b><div class="vp-menu" data-v-c02d6d2b data-v-97b8bc66><div class="items" data-v-97b8bc66><!--[--><!--[--><div class="vp-menu-link" data-v-97b8bc66 data-v-f09a0f1d><a class="vp-link no-icon link" href="/demo/" data-v-f09a0f1d data-v-8fd51d7e><!--[--><!----> 示例<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><!----><div class="vp-social-links vp-navbar-social-links social-links" data-v-fb9743c7 data-v-b384e0a0 data-v-820a862b><!--[--><a class="vp-social-link no-icon" href="https://github.com/callMeExiao/callMeExiao.github.io" aria-label="github" target="_blank" rel="noopener" data-v-820a862b data-v-20c69dec><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-fb9743c7 data-v-450b28d0 data-v-c02d6d2b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-c02d6d2b><span class="vpi-more-horizontal icon" data-v-c02d6d2b></span></button><div class="menu" data-v-c02d6d2b><div class="vp-menu" data-v-c02d6d2b data-v-97b8bc66><!----><!--[--><!--[--><!----><!----><div class="group" data-v-450b28d0><div class="item social-links" data-v-450b28d0><div class="vp-social-links social-links-list" data-v-450b28d0 data-v-820a862b><!--[--><a class="vp-social-link no-icon" href="https://github.com/callMeExiao/callMeExiao.github.io" aria-label="github" target="_blank" rel="noopener" data-v-820a862b data-v-20c69dec><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-fb9743c7 data-v-1bb12327><span class="container" data-v-1bb12327><span class="top" data-v-1bb12327></span><span class="middle" data-v-1bb12327></span><span class="bottom" data-v-1bb12327></span></span></button></div></div></div></div><div class="divider" data-v-fb9743c7><div class="divider-line" data-v-fb9743c7></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-3bf3774b data-v-f47454cb><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-f47454cb><span class="vpi-align-left menu-icon" data-v-f47454cb></span><span class="menu-text" data-v-f47454cb>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-f47454cb data-v-9029d9f5><button data-v-9029d9f5>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-3bf3774b data-v-63d685ff><div class="vp-doc-container is-blog" data-v-63d685ff data-v-48823583><!--[--><!--]--><div class="container" data-v-48823583><!----><div class="content" data-v-48823583><div class="content-container" data-v-48823583><!--[--><!--]--><main class="main" data-v-48823583><nav class="vp-breadcrumb" data-v-48823583 data-v-c735a90d><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-c735a90d><!--[--><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-c735a90d></span><meta property="name" content="首页" data-v-c735a90d><meta property="position" content="1" data-v-c735a90d></li><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-c735a90d></span><meta property="name" content="博客" data-v-c735a90d><meta property="position" content="2" data-v-c735a90d></li><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=543517" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->后端技术<!--]--><!----></a><span class="vpi-chevron-right" data-v-c735a90d></span><meta property="name" content="后端技术" data-v-c735a90d><meta property="position" content="3" data-v-c735a90d></li><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb current" href="/article/n1khzto6/" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->ddd-architecture-blog<!--]--><!----></a><!----><meta property="name" content="ddd-architecture-blog" data-v-c735a90d><meta property="position" content="4" data-v-c735a90d></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-d8ca9256>ddd-architecture-blog <!----></h1><div class="vp-doc-meta" data-v-d8ca9256><p class="reading-time" data-v-d8ca9256><span class="vpi-books icon" data-v-d8ca9256></span><span data-v-d8ca9256>约 2600 字</span><span data-v-d8ca9256>大约 9 分钟</span></p><!----><p class="create-time" data-v-d8ca9256><span class="vpi-clock icon" data-v-d8ca9256></span><span data-v-d8ca9256>2026-02-09</span></p></div><!--]--><div class="_article_n1khzto6_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-48823583><div data-v-48823583><blockquote><p>更新时间：2026-02-08<br> 目标读者：刚接触 DDD、希望看懂本项目分层与术语的人</p></blockquote><h2 id="先说结论-tl-dr" tabindex="-1"><a class="header-anchor" href="#先说结论-tl-dr"><span>先说结论（TL;DR）</span></a></h2><p>这个项目是一个 <strong>“分层架构 + DDD 思想（部分落地）”</strong> 的工程，不是教科书式“纯 DDD”，但已经有很清晰的 DDD 轮廓：</p><ul><li>模块上分成 <code>start</code> / <code>adapter</code> / <code>application</code> / <code>domain</code> / <code>infrastructure</code> 五层。</li><li>交互上大量采用 <code>Cmd/Query + Handler + Mediator</code>，把控制器和业务逻辑解耦。</li><li>领域层有网关接口（<code>*Gateway</code>），基础设施层有实现（<code>*GatewayImpl</code>），体现依赖倒置。</li><li>领域模型里既有“充血模型”案例，也有“贫血模型”案例，属于演进中的真实项目状态。</li></ul><h2 id="对外发布脱敏说明-建议保留" tabindex="-1"><a class="header-anchor" href="#对外发布脱敏说明-建议保留"><span>对外发布脱敏说明（建议保留）</span></a></h2><p>如果这篇文章用于公开平台（公众号/掘金/知乎），建议按以下规则脱敏：</p><ul><li><strong>包名/组织名脱敏</strong>：<code>com.xxx</code> 统一替换为 <code>com.example</code>。</li><li><strong>项目名脱敏</strong>：真实仓库名替换为 <code>project-a</code> 或 <code>sample-backend</code>。</li><li><strong>外部系统脱敏</strong>：第三方平台名、队列名、桶名、域名统一用 <code>A系统/B系统</code> 代替。</li><li><strong>数据库信息脱敏</strong>：表名可保留语义但避免暴露真实命名规范（如前缀规则、租户标识）。</li><li><strong>配置脱敏</strong>：URL、Token、账号、密钥、内网地址必须全部替换为占位符。</li></ul><p>本文中的“代码片段”已按通用命名表达业务思想，避免依赖真实项目细节。</p><hr><h2 id="我是怎么判断的-说明与假设" tabindex="-1"><a class="header-anchor" href="#我是怎么判断的-说明与假设"><span>我是怎么判断的（说明与假设）</span></a></h2><p>本文基于仓库代码静态分析，重点参考了以下文件：</p><ul><li>根模块与依赖：<code>pom.xml</code></li><li>各模块依赖： <ul><li><code>zjdghy-backend-start/pom.xml</code></li><li><code>zjdghy-backend-adapter/pom.xml</code></li><li><code>zjdghy-backend-application/pom.xml</code></li><li><code>zjdghy-backend-domain/pom.xml</code></li><li><code>zjdghy-backend-infrastructure/pom.xml</code></li></ul></li><li>典型链路样例： <ul><li><code>zjdghy-backend-adapter/src/main/java/com/ptkj/controller/fo/IndicatorsController.java</code></li><li><code>zjdghy-backend-application/src/main/java/com/ptkj/cameratask/task/CameraTaskScheduler.java</code></li><li><code>zjdghy-backend-application/src/main/java/com/ptkj/cameratask/ExecuteCameraTaskCmdHandler.java</code></li><li><code>zjdghy-backend-domain/src/main/java/com/ptkj/cameratask/CameraTask.java</code></li><li><code>zjdghy-backend-domain/src/main/java/com/ptkj/cameratask/gateway/CameraTaskGateway.java</code></li><li><code>zjdghy-backend-infrastructure/src/main/java/com/ptkj/cameratask/gatewayimpl/CameraTaskGatewayImpl.java</code></li><li><code>zjdghy-backend-infrastructure/src/main/resources/mybatis/CameraTaskMapper.xml</code></li></ul></li></ul><hr><h2 id="_1-先看架构全景-模块维度" tabindex="-1"><a class="header-anchor" href="#_1-先看架构全景-模块维度"><span>1. 先看架构全景（模块维度）</span></a></h2><p>根 <code>pom.xml</code> 是 Maven 多模块工程，模块如下：</p><ul><li><code>zjdghy-backend-start</code>：Spring Boot 启动与装配</li><li><code>zjdghy-backend-adapter</code>：HTTP/WebSocket 接口适配层</li><li><code>zjdghy-backend-application</code>：应用编排层（命令/查询处理、任务、监听）</li><li><code>zjdghy-backend-domain</code>：领域模型、网关接口、业务枚举</li><li><code>zjdghy-backend-infrastructure</code>：DB/MQ/外部系统等技术实现层</li></ul><p>一句话理解：</p><p><strong>用户请求先到 adapter，业务由 application 编排，核心概念在 domain，具体落地在 infrastructure，最后由 start 启动所有组件。</strong></p><hr><h2 id="_2-项目里的典型调用链" tabindex="-1"><a class="header-anchor" href="#_2-项目里的典型调用链"><span>2. 项目里的典型调用链</span></a></h2><h3 id="_2-1-http-查询链路-以指标查询为例" tabindex="-1"><a class="header-anchor" href="#_2-1-http-查询链路-以指标查询为例"><span>2.1 HTTP 查询链路（以指标查询为例）</span></a></h3><div class="language-mermaid line-numbers-mode" data-ext="mermaid" data-title="mermaid"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>sequenceDiagram</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>Client</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;客户端&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>C</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;Adapter</span><span class="space"> </span><span>Controller&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>M</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;Mediator&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>H</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;QueryHandler&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>G</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;Domain</span><span class="space"> </span><span>Gateway&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>I</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;GatewayImpl/Mapper&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>participant</span><span class="space"> </span><span>DB</span><span class="space"> </span><span>as</span><span class="space"> </span><span>&quot;数据库&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>Client-&gt;&gt;C:</span><span class="space"> </span><span>HTTP请求</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>C-&gt;&gt;M:</span><span class="space"> </span><span>mediator.send(query)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>M-&gt;&gt;H:</span><span class="space"> </span><span>分发到对应Handler</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>H-&gt;&gt;G:</span><span class="space"> </span><span>调用领域网关接口</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>G-&gt;&gt;I:</span><span class="space"> </span><span>基础设施实现查询</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>I-&gt;&gt;DB:</span><span class="space"> </span><span>SQL/MyBatis</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>DB--&gt;&gt;I:</span><span class="space"> </span><span>结果</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>I--&gt;&gt;H:</span><span class="space"> </span><span>领域/DTO对象</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>H--&gt;&gt;C:</span><span class="space"> </span><span>业务结果</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>C--&gt;&gt;Client:</span><span class="space"> </span><span>DataApiResponse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应代码可看：</p><ul><li>Controller：<code>.../IndicatorsController.java</code></li><li>Handler：<code>.../FoXzqIndicatorsWarningSummaryQueryHandler.java</code></li><li>Gateway 接口：<code>.../foindicators/gateway/FoXzqIndicatorsGateway.java</code></li><li>Gateway 实现：<code>.../foindicators/gatewayimpl/FoXzqIndicatorsGatewayImpl.java</code></li></ul><h3 id="_2-2-定时任务-mq-命令链路-以摄像头任务为例" tabindex="-1"><a class="header-anchor" href="#_2-2-定时任务-mq-命令链路-以摄像头任务为例"><span>2.2 定时任务 + MQ + 命令链路（以摄像头任务为例）</span></a></h3><div class="language-mermaid line-numbers-mode" data-ext="mermaid" data-title="mermaid"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>flowchart</span><span class="space"> </span><span>LR</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>A[&quot;@Scheduled</span><span class="space"> </span><span>扫描任务&quot;]</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>B[&quot;CameraTaskGateway.findPendingTasks&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>B</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>C[&quot;发送RabbitMQ消息&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>C</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>D[&quot;MQ</span><span class="space"> </span><span>Listener消费&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>D</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>E[&quot;Mediator.send(ExecuteCameraTaskCmd)&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>E</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>F[&quot;ExecuteCameraTaskCmdHandler&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span>F</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>G[&quot;调用平台接口/存储OSS/更新任务状态&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应代码可看：</p><ul><li>调度：<code>.../cameratask/task/CameraTaskScheduler.java</code></li><li>消费：<code>.../cameratask/listener/CameraTaskMessageListener.java</code></li><li>命令处理：<code>.../cameratask/ExecuteCameraTaskCmdHandler.java</code></li></ul><hr><h2 id="_3-每一层到底干什么-带项目映射" tabindex="-1"><a class="header-anchor" href="#_3-每一层到底干什么-带项目映射"><span>3. 每一层到底干什么（带项目映射）</span></a></h2><h3 id="_3-1-adapter-接口适配层" tabindex="-1"><a class="header-anchor" href="#_3-1-adapter-接口适配层"><span>3.1 Adapter（接口适配层）</span></a></h3><p>职责：接协议、做入参校验、组装命令/查询、返回统一响应。</p><p>特征：</p><ul><li><code>@RestController + /api/...</code></li><li>DTO 放在 <code>controller/dto</code></li><li>常见 <code>@Valid</code> 校验</li><li>通过 <code>mediator.send(...)</code> 进入应用层</li></ul><p>样例：</p><ul><li><code>zjdghy-backend-adapter/src/main/java/com/ptkj/controller/FlowCommentsTemplateController.java</code></li><li><code>zjdghy-backend-adapter/src/main/java/com/ptkj/controller/dto/SaveFlowCommentsTemplateRequest.java</code></li></ul><h3 id="_3-2-application-应用层" tabindex="-1"><a class="header-anchor" href="#_3-2-application-应用层"><span>3.2 Application（应用层）</span></a></h3><p>职责：业务流程编排，不直接关心底层技术细节。</p><p>常见内容：</p><ul><li><code>*Cmd</code> / <code>*Query</code>（用例输入）</li><li><code>*CmdHandler</code> / <code>*QueryHandler</code>（用例处理）</li><li><code>task</code>（定时任务）</li><li><code>listener</code>（消息监听）</li></ul><p>样例：</p><ul><li><code>zjdghy-backend-application/src/main/java/com/ptkj/workflow/comments/SaveFlowCommentsTemplateCmdHandler.java</code></li><li><code>zjdghy-backend-application/src/main/java/com/ptkj/cameratask/ExecuteCameraTaskCmdHandler.java</code></li></ul><h3 id="_3-3-domain-领域层" tabindex="-1"><a class="header-anchor" href="#_3-3-domain-领域层"><span>3.3 Domain（领域层）</span></a></h3><p>职责：沉淀业务概念、规则和抽象。</p><p>在这个项目里主要包含：</p><ul><li>领域模型（如 <code>CameraTask</code>、<code>AlarmSummary</code>）</li><li>领域网关接口（<code>*Gateway</code>）</li><li>领域枚举、少量领域规则（如 <code>FoIndicatorWarningEvaluator</code>）</li></ul><p>样例：</p><ul><li><code>zjdghy-backend-domain/src/main/java/com/ptkj/cameratask/CameraTask.java</code></li><li><code>zjdghy-backend-domain/src/main/java/com/ptkj/cameratask/gateway/CameraTaskGateway.java</code></li></ul><h3 id="_3-4-infrastructure-基础设施层" tabindex="-1"><a class="header-anchor" href="#_3-4-infrastructure-基础设施层"><span>3.4 Infrastructure（基础设施层）</span></a></h3><p>职责：把 domain 的抽象落到技术实现。</p><p>在这个项目里常见为：</p><ul><li><code>*GatewayImpl</code>（实现 domain 网关）</li><li><code>*Mapper</code>、<code>*DO</code>、<code>mybatis/*.xml</code></li><li>对接 MQ、OSS、第三方 API</li></ul><p>样例：</p><ul><li><code>zjdghy-backend-infrastructure/src/main/java/com/ptkj/cameratask/gatewayimpl/CameraTaskGatewayImpl.java</code></li><li><code>zjdghy-backend-infrastructure/src/main/resources/mybatis/CameraTaskMapper.xml</code></li></ul><h3 id="_3-5-start-启动层" tabindex="-1"><a class="header-anchor" href="#_3-5-start-启动层"><span>3.5 Start（启动层）</span></a></h3><p>职责：Spring Boot 启动、配置装配。</p><p>样例：</p><ul><li><code>zjdghy-backend-start/src/main/java/com/ptkj/Application.java</code></li></ul><hr><h2 id="_4-ddd-术语词典-结合本项目解释" tabindex="-1"><a class="header-anchor" href="#_4-ddd-术语词典-结合本项目解释"><span>4. DDD 术语词典（结合本项目解释）</span></a></h2><p>下面是你写博客时最常被问到的术语，我用“定义 + 本项目例子”解释。</p><h3 id="_4-1-ddd-领域驱动设计" tabindex="-1"><a class="header-anchor" href="#_4-1-ddd-领域驱动设计"><span>4.1 DDD（领域驱动设计）</span></a></h3><ul><li>定义：先围绕业务领域建模，再让代码结构服务于业务模型。</li><li>本项目理解：包名、类名大量按业务域组织（如 <code>cameratask</code>、<code>workflow</code>、<code>fo</code>）。</li></ul><h3 id="_4-2-统一语言-ubiquitous-language" tabindex="-1"><a class="header-anchor" href="#_4-2-统一语言-ubiquitous-language"><span>4.2 统一语言（Ubiquitous Language）</span></a></h3><ul><li>定义：产品、业务、研发说同一套词，避免“需求叫A，代码叫B”。</li><li>本项目例子：<code>CameraTask</code>、<code>WarningStrategy</code>、<code>FlowInstance</code> 等业务词直接进入代码。</li></ul><h3 id="_4-3-限界上下文-bounded-context" tabindex="-1"><a class="header-anchor" href="#_4-3-限界上下文-bounded-context"><span>4.3 限界上下文（Bounded Context）</span></a></h3><ul><li>定义：某个业务模型适用的边界，不同上下文可对同一词有不同含义。</li><li>本项目可视角：<code>workflow</code>、<code>fo.warninginfo</code>、<code>cameratask</code> 都可视作上下文候选。</li></ul><h3 id="_4-4-实体-entity" tabindex="-1"><a class="header-anchor" href="#_4-4-实体-entity"><span>4.4 实体（Entity）</span></a></h3><ul><li>定义：有唯一标识（ID）、生命周期可持续演化的对象。</li><li>本项目例子：<code>CameraTask</code>、<code>AlarmSummary</code>。</li></ul><h3 id="_4-5-值对象-value-object" tabindex="-1"><a class="header-anchor" href="#_4-5-值对象-value-object"><span>4.5 值对象（Value Object）</span></a></h3><ul><li>定义：靠“值”而不是“ID”区分，通常不可变，适合表达一段业务语义。</li><li>本项目现状：有 <code>VO/DTO</code> 命名对象（如 <code>ClueListVO</code>），但“严格值对象”模式还不算突出。</li></ul><h3 id="_4-6-聚合-aggregate-与聚合根-aggregate-root" tabindex="-1"><a class="header-anchor" href="#_4-6-聚合-aggregate-与聚合根-aggregate-root"><span>4.6 聚合（Aggregate）与聚合根（Aggregate Root）</span></a></h3><ul><li>定义：一组需要强一致性维护的对象集合；对外只通过“聚合根”访问。</li><li>本项目观察：已经有“按领域对象 + 网关”组织方式，但“显式聚合边界”标识还偏弱。</li></ul><h3 id="_4-7-领域服务-domain-service" tabindex="-1"><a class="header-anchor" href="#_4-7-领域服务-domain-service"><span>4.7 领域服务（Domain Service）</span></a></h3><ul><li>定义：不适合放到某个实体里的领域规则（通常跨实体/跨聚合）。</li><li>本项目例子：<code>FoIndicatorWarningEvaluator</code> 承担了指标预警规则计算。</li></ul><h3 id="_4-8-应用服务-application-service" tabindex="-1"><a class="header-anchor" href="#_4-8-应用服务-application-service"><span>4.8 应用服务（Application Service）</span></a></h3><ul><li>定义：负责流程编排、事务、权限、调用多个领域能力，不承载核心领域知识。</li><li>本项目例子：<code>FoWarningInfoWorkflowAppService</code> 编排了流程推进、事件发布、外部副作用。</li></ul><h3 id="_4-9-仓储-repository-网关-gateway" tabindex="-1"><a class="header-anchor" href="#_4-9-仓储-repository-网关-gateway"><span>4.9 仓储（Repository）/ 网关（Gateway）</span></a></h3><ul><li>定义：屏蔽存储和外部系统细节，领域层只依赖抽象。</li><li>本项目落地：接口在 domain（如 <code>CameraTaskGateway</code>），实现在 infrastructure（<code>CameraTaskGatewayImpl</code>）。</li></ul><h3 id="_4-10-领域事件-domain-event" tabindex="-1"><a class="header-anchor" href="#_4-10-领域事件-domain-event"><span>4.10 领域事件（Domain Event）</span></a></h3><ul><li>定义：描述“领域里已经发生的事实”。</li><li>本项目例子：<code>WarningStatusChangedEvent</code>。</li></ul><h3 id="_4-11-防腐层-acl-anti-corruption-layer" tabindex="-1"><a class="header-anchor" href="#_4-11-防腐层-acl-anti-corruption-layer"><span>4.11 防腐层（ACL, Anti-Corruption Layer）</span></a></h3><ul><li>定义：对接外部系统时做转换与隔离，避免外部模型污染内部模型。</li><li>本项目例子：多个 <code>GatewayImpl</code> 在做第三方/数据库协议转换，本质就在承担防腐层职责。</li></ul><h3 id="_4-12-贫血模型-anemic-model-vs-充血模型-rich-model" tabindex="-1"><a class="header-anchor" href="#_4-12-贫血模型-anemic-model-vs-充血模型-rich-model"><span>4.12 贫血模型（Anemic Model） vs 充血模型（Rich Model）</span></a></h3><p>这是你特别关心的点，单独展开：</p><h4 id="贫血模型-anemic-model" tabindex="-1"><a class="header-anchor" href="#贫血模型-anemic-model"><span>贫血模型（Anemic Model）</span></a></h4><ul><li>特征：类里主要是字段 + getter/setter，业务规则在 Service/Handler。</li><li>优点：上手快、改动直接。</li><li>缺点：规则分散，难维护，容易“哪里都能改状态”。</li><li>本项目例子：<code>AlarmSummary</code>、<code>Tree</code> 以数据承载为主，行为较少。</li></ul><h4 id="充血模型-rich-model" tabindex="-1"><a class="header-anchor" href="#充血模型-rich-model"><span>充血模型（Rich Model）</span></a></h4><ul><li>特征：对象自己封装状态变化规则，提供业务行为方法。</li><li>优点：规则内聚、可读性和可维护性更好。</li><li>缺点：设计门槛更高，需要明确边界与不变量。</li><li>本项目例子：<code>CameraTask</code> 已有较明显的行为方法： <ul><li><code>isActive()</code></li><li><code>updateExecResult(...)</code></li><li><code>markCompleted()/markFailed()/resetToPending()</code></li><li><code>retryFailedTask()</code></li><li><code>calculateNextExecTime()</code></li></ul></li></ul><h4 id="为什么叫-充血-与-贫血-术语来源" tabindex="-1"><a class="header-anchor" href="#为什么叫-充血-与-贫血-术语来源"><span>为什么叫“充血”与“贫血”？（术语来源）</span></a></h4><p>这两个词是医学隐喻：</p><ul><li>“血”在医学里代表营养与活力；</li><li>在 DDD 里，“血”类比业务规则与行为能力；</li><li>所以： <ul><li><strong>贫血模型</strong>：对象里主要只有字段（像“只有骨架”），业务规则大量外置到 Service/Handler；</li><li><strong>充血模型</strong>：对象既有字段也有行为（像“有血有肉”），能在对象内部维护状态变更和业务约束。</li></ul></li></ul><p>可以记成一句话：</p><p><strong>“数据 + 行为同居”是充血；“数据在实体、行为在服务”是贫血。</strong></p><h4 id="一段可直接放博客的对比示例" tabindex="-1"><a class="header-anchor" href="#一段可直接放博客的对比示例"><span>一段可直接放博客的对比示例</span></a></h4><p>下面用“任务失败后重置待执行”举例：</p><p>贫血写法（规则在 Service）：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">Entity</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">只有字段</span></span>
<span class="line"><span style="color:#E5C07B;">job</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setStatus</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JobStatus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">PENDING</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">job</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setNextRunAt</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">job</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLastRunAt</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">plusHours</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#E5C07B;">job</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setUpdatedAt</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Instant</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">jobRepository</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(job);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>充血写法（规则在模型）：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">Entity</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">内部封装规则</span></span>
<span class="line"><span style="color:#E5C07B;">job</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">retryAfterFailure</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">jobRepository</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(job);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为什么后者更好：</p><ul><li>规则只写一处，避免多个 Service 各写一版；</li><li>语义更清晰（方法名就是业务动作）；</li><li>后续规则变化（比如从 +1 小时改成按策略计算）只改模型内部。</li></ul><p>一句话总结：</p><p><strong>这个项目是“贫血 + 充血并存”的过渡态，且正朝更充血的方向演进。</strong></p><hr><h2 id="_5-这个项目-ddd-落地程度-怎么评价" tabindex="-1"><a class="header-anchor" href="#_5-这个项目-ddd-落地程度-怎么评价"><span>5. 这个项目“DDD 落地程度”怎么评价？</span></a></h2><p>我给的判断是：<strong>DDD-Lite 到 DDD-中级演进期</strong>。</p><h3 id="已经做得不错的地方" tabindex="-1"><a class="header-anchor" href="#已经做得不错的地方"><span>已经做得不错的地方</span></a></h3><ul><li>模块边界清晰，多模块划分符合分层思想。</li><li><code>Cmd/Query + Handler</code> 让用例边界清楚。</li><li>网关接口与实现分离，依赖倒置方向基本正确。</li><li>实战里把定时任务、MQ、外部接口纳入同一业务链路，工程化成熟度不错。</li></ul><h3 id="仍有-非纯-ddd-痕迹-真实项目常见" tabindex="-1"><a class="header-anchor" href="#仍有-非纯-ddd-痕迹-真实项目常见"><span>仍有“非纯 DDD”痕迹（真实项目常见）</span></a></h3><ul><li><code>application</code> 模块仍直接依赖 <code>infrastructure</code>（模块 <code>pom</code> 里也有注释说明是过渡态）。</li><li>领域层中部分对象偏 DTO 风格，聚合根边界还不够显式。</li><li>领域模块里可见少量 Spring 工具类依赖，说明“纯领域隔离”尚未完全做到。</li></ul><p>这不是“好坏”问题，而是 <strong>架构演进阶段</strong> 问题。</p><hr><h2 id="_6-如果你要写博客-可以这样下标题" tabindex="-1"><a class="header-anchor" href="#_6-如果你要写博客-可以这样下标题"><span>6. 如果你要写博客，可以这样下标题</span></a></h2><p>可选标题：</p><ol><li>《我在真实项目里读懂 DDD：从贫血模型到充血模型》</li><li>《五层模块 + Cmd/Query：一个 Java 后端的 DDD 实战拆解》</li><li>《不是教科书，但很好用：zjdghy-backend 的 DDD 架构解读》</li></ol><hr><h2 id="_7-你后续可以继续补充的两块-建议" tabindex="-1"><a class="header-anchor" href="#_7-你后续可以继续补充的两块-建议"><span>7. 你后续可以继续补充的两块（建议）</span></a></h2><ol><li><strong>补一张“目录到分层”的图</strong>：让读者 10 秒看懂项目结构。</li><li><strong>补一条“从 Controller 到 SQL 的真实调用链”</strong>：读者最有代入感。</li></ol><hr><h2 id="_8-给你的-一句话记忆法" tabindex="-1"><a class="header-anchor" href="#_8-给你的-一句话记忆法"><span>8. 给你的“一句话记忆法”</span></a></h2><p><strong>DDD 不是为了把代码写复杂，而是为了让“业务规则有家可回”。</strong></p><p>在这个项目里，这个“家”正在从“服务里到处散落”，逐步迁到“领域模型与网关抽象”中。</p></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-48823583 data-v-9110afba><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-9110afba><span class="contributors-label" data-v-9110afba>贡献者: </span><span class="contributors-info" data-v-9110afba><!--[--><!--[--><span class="contributor" data-v-9110afba>金逸霄</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-9110afba><div class="pager" data-v-9110afba><a class="vp-link no-icon link pager-link prev" href="/article/b8e5hzao/" data-v-9110afba data-v-8fd51d7e><!--[--><span class="desc" data-v-9110afba>上一页</span><span class="title" data-v-9110afba>jpa-vs-mybatis-analysis</span><!--]--><!----></a></div><div class="pager" data-v-9110afba><a class="vp-link no-icon link pager-link next" href="/article/9zmbnu1t/" data-v-9110afba data-v-8fd51d7e><!--[--><span class="desc" data-v-9110afba>下一页</span><span class="title" data-v-9110afba>node_modules&npm&pnpm都是咩啊</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-3bf3774b style="display:none;" data-v-22e14b5d><span class="percent" data-allow-mismatch data-v-22e14b5d>0%</span><span class="show icon vpi-back-to-top" data-v-22e14b5d></span><svg aria-hidden="true" data-v-22e14b5d><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-22e14b5d></circle></svg></button><footer class="vp-footer" vp-footer data-v-3bf3774b data-v-232bff92><!--[--><div class="container" data-v-232bff92><p class="message" data-v-232bff92>————————到底啦!————————</p><p class="copyright" data-v-232bff92>copyleft © 2025 Exiao</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-pBrtxVLr.js" defer></script></body></html>