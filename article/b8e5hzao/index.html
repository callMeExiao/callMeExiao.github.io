<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.20" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><meta property="og:url" content="https://callmeexiao.baby/article/b8e5hzao/"><meta property="og:site_name" content="Exiao's Blog"><meta property="og:title" content="jpa-vs-mybatis-analysis"><meta property="og:description" content="先说结论 如果你时间有限，只看这一段： 复杂 SQL 多、报表多、数据库方言特性重（如 PostgreSQL jsonb）：优先 MyBatis（或 MyBatis-Plus）。 标准 CRUD 多、领域关系清晰、希望快速开发：优先 JPA（Spring Data JPA）。 大多数中大型项目最终是混用：核心复杂查询用 MyBatis，简单聚合读写用 ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2026-02-09T04:43:36.000Z"><meta property="article:modified_time" content="2026-02-09T04:43:36.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"jpa-vs-mybatis-analysis","image":[""],"dateModified":"2026-02-09T04:43:36.000Z","author":[]}</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>jpa-vs-mybatis-analysis | Exiao's Blog</title><meta name="description" content="先说结论 如果你时间有限，只看这一段： 复杂 SQL 多、报表多、数据库方言特性重（如 PostgreSQL jsonb）：优先 MyBatis（或 MyBatis-Plus）。 标准 CRUD 多、领域关系清晰、希望快速开发：优先 JPA（Spring Data JPA）。 大多数中大型项目最终是混用：核心复杂查询用 MyBatis，简单聚合读写用 ..."><link rel="preload" href="/assets/style-Cd332rkf.css" as="style"><link rel="stylesheet" href="/assets/style-Cd332rkf.css"><link rel="modulepreload" href="/assets/app-pBrtxVLr.js"><link rel="modulepreload" href="/assets/index.html-Da3oDbgu.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-3bf3774b><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-1afd8ef4></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-1afd8ef4> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-3bf3774b data-v-93076610><div class="vp-navbar" vp-navbar data-v-93076610 data-v-fb9743c7><div class="wrapper" data-v-fb9743c7><div class="container" data-v-fb9743c7><div class="title" data-v-fb9743c7><div class="vp-navbar-title" data-v-fb9743c7 data-v-800466e1><a class="vp-link no-icon link title" href="/" data-v-800466e1 data-v-8fd51d7e><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-c4044e2a><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-c4044e2a><!--]--><!--]--><!--]--><span data-v-800466e1>Exiao&#39;s Blog</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-fb9743c7><div class="content-body" data-v-fb9743c7><!--[--><!--]--><div class="vp-navbar-search search" data-v-fb9743c7><div class="search-wrapper" data-v-9b6231cb><!----><div id="local-search" data-v-9b6231cb><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-9b6231cb><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-fb9743c7 data-v-f0b866c0><span id="main-nav-aria-label" class="visually-hidden" data-v-f0b866c0>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/tags/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>标签</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-f0b866c0 data-v-575a5ecb data-v-8fd51d7e><!--[--><!----><span data-v-575a5ecb>归档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-f0b866c0 data-v-c02d6d2b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-c02d6d2b><span class="text" data-v-c02d6d2b><!----><!----><span data-v-c02d6d2b>笔记</span><span class="vpi-chevron-down text-icon" data-v-c02d6d2b></span></span></button><div class="menu" data-v-c02d6d2b><div class="vp-menu" data-v-c02d6d2b data-v-97b8bc66><div class="items" data-v-97b8bc66><!--[--><!--[--><div class="vp-menu-link" data-v-97b8bc66 data-v-f09a0f1d><a class="vp-link no-icon link" href="/demo/" data-v-f09a0f1d data-v-8fd51d7e><!--[--><!----> 示例<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><!----><div class="vp-social-links vp-navbar-social-links social-links" data-v-fb9743c7 data-v-b384e0a0 data-v-820a862b><!--[--><a class="vp-social-link no-icon" href="https://github.com/callMeExiao/callMeExiao.github.io" aria-label="github" target="_blank" rel="noopener" data-v-820a862b data-v-20c69dec><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-fb9743c7 data-v-450b28d0 data-v-c02d6d2b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-c02d6d2b><span class="vpi-more-horizontal icon" data-v-c02d6d2b></span></button><div class="menu" data-v-c02d6d2b><div class="vp-menu" data-v-c02d6d2b data-v-97b8bc66><!----><!--[--><!--[--><!----><!----><div class="group" data-v-450b28d0><div class="item social-links" data-v-450b28d0><div class="vp-social-links social-links-list" data-v-450b28d0 data-v-820a862b><!--[--><a class="vp-social-link no-icon" href="https://github.com/callMeExiao/callMeExiao.github.io" aria-label="github" target="_blank" rel="noopener" data-v-820a862b data-v-20c69dec><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-fb9743c7 data-v-1bb12327><span class="container" data-v-1bb12327><span class="top" data-v-1bb12327></span><span class="middle" data-v-1bb12327></span><span class="bottom" data-v-1bb12327></span></span></button></div></div></div></div><div class="divider" data-v-fb9743c7><div class="divider-line" data-v-fb9743c7></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-3bf3774b data-v-f47454cb><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-f47454cb><span class="vpi-align-left menu-icon" data-v-f47454cb></span><span class="menu-text" data-v-f47454cb>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-f47454cb data-v-9029d9f5><button data-v-9029d9f5>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-3bf3774b data-v-63d685ff><div class="vp-doc-container is-blog" data-v-63d685ff data-v-48823583><!--[--><!--]--><div class="container" data-v-48823583><!----><div class="content" data-v-48823583><div class="content-container" data-v-48823583><!--[--><!--]--><main class="main" data-v-48823583><nav class="vp-breadcrumb" data-v-48823583 data-v-c735a90d><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-c735a90d><!--[--><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-c735a90d></span><meta property="name" content="首页" data-v-c735a90d><meta property="position" content="1" data-v-c735a90d></li><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-c735a90d></span><meta property="name" content="博客" data-v-c735a90d><meta property="position" content="2" data-v-c735a90d></li><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=543517" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->后端技术<!--]--><!----></a><span class="vpi-chevron-right" data-v-c735a90d></span><meta property="name" content="后端技术" data-v-c735a90d><meta property="position" content="3" data-v-c735a90d></li><li property="itemListElement" typeof="ListItem" data-v-c735a90d><a class="vp-link no-icon link breadcrumb current" href="/article/b8e5hzao/" property="item" typeof="WebPage" data-v-c735a90d data-v-8fd51d7e><!--[-->jpa-vs-mybatis-analysis<!--]--><!----></a><!----><meta property="name" content="jpa-vs-mybatis-analysis" data-v-c735a90d><meta property="position" content="4" data-v-c735a90d></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-d8ca9256>jpa-vs-mybatis-analysis <!----></h1><div class="vp-doc-meta" data-v-d8ca9256><p class="reading-time" data-v-d8ca9256><span class="vpi-books icon" data-v-d8ca9256></span><span data-v-d8ca9256>约 1652 字</span><span data-v-d8ca9256>大约 6 分钟</span></p><!----><p class="create-time" data-v-d8ca9256><span class="vpi-clock icon" data-v-d8ca9256></span><span data-v-d8ca9256>2026-02-09</span></p></div><!--]--><div class="_article_b8e5hzao_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-48823583><div data-v-48823583><h2 id="先说结论" tabindex="-1"><a class="header-anchor" href="#先说结论"><span>先说结论</span></a></h2><p>如果你时间有限，只看这一段：</p><ul><li><strong>复杂 SQL 多、报表多、数据库方言特性重（如 PostgreSQL <code>jsonb</code>）</strong>：优先 MyBatis（或 MyBatis-Plus）。</li><li><strong>标准 CRUD 多、领域关系清晰、希望快速开发</strong>：优先 JPA（Spring Data JPA）。</li><li><strong>大多数中大型项目最终是混用</strong>：核心复杂查询用 MyBatis，简单聚合读写用 JPA。</li></ul><p>这不是“谁更先进”的问题，而是“谁更匹配你的业务形态”。</p><hr><h2 id="_1-两者本质差异-orm-vs-sql-mapper" tabindex="-1"><a class="header-anchor" href="#_1-两者本质差异-orm-vs-sql-mapper"><span>1. 两者本质差异：ORM vs SQL Mapper</span></a></h2><ul><li><strong>JPA（ORM）</strong>：你主要操作“对象”，框架帮你生成和管理 SQL。</li><li><strong>MyBatis（SQL Mapper）</strong>：你主要操作“SQL”，框架帮你做参数绑定和结果映射。</li></ul><div class="language-mermaid line-numbers-mode" data-ext="mermaid" data-title="mermaid"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>flowchart</span><span class="space"> </span><span>LR</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>A[&quot;业务代码&quot;]</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>B[&quot;JPA</span><span class="space"> </span><span>Repository&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>B</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>C[&quot;JPQL/派生方法&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>C</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>D[&quot;ORM</span><span class="space"> </span><span>引擎生成</span><span class="space"> </span><span>SQL&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>D</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>E[&quot;数据库&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>A2[&quot;业务代码&quot;]</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>B2[&quot;MyBatis</span><span class="space"> </span><span>Mapper&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>B2</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>C2[&quot;手写</span><span class="space"> </span><span>SQL/XML&quot;]</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span>C2</span><span class="space"> </span><span>--&gt;</span><span class="space"> </span><span>E2[&quot;数据库&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一句话理解：</p><ul><li>JPA 追求“<strong>面向对象开发效率</strong>”。</li><li>MyBatis 追求“<strong>面向 SQL 的可控性</strong>”。</li></ul><hr><h2 id="_2-9-个维度对比-教学版" tabindex="-1"><a class="header-anchor" href="#_2-9-个维度对比-教学版"><span>2. 9 个维度对比（教学版）</span></a></h2><table><thead><tr><th>维度</th><th>JPA</th><th>MyBatis / MyBatis-Plus</th><th>选型建议</th></tr></thead><tbody><tr><td>学习曲线</td><td>要理解实体状态、懒加载、脏检查</td><td>要理解 SQL/索引/执行计划</td><td>初学 CRUD 选 JPA；要深控性能选 MyBatis</td></tr><tr><td>CRUD 开发效率</td><td>非常高（<code>JpaRepository</code>）</td><td>中等（MP 可提高）</td><td>标准增删改查：JPA 更快</td></tr><tr><td>复杂查询表达</td><td>复杂时常回退 <code>nativeQuery</code></td><td>天然强项，SQL 直写</td><td>报表/统计/复杂 join：MyBatis</td></tr><tr><td>动态条件查询</td><td>Specification/Criteria 类型安全</td><td>XML <code>if/where/trim</code> 直观</td><td>团队习惯决定，MyBatis 更“所见即所得”</td></tr><tr><td>数据库方言能力</td><td>依赖 ORM 支持，方言越重越麻烦</td><td>方言可直接用</td><td><code>jsonb</code>/窗口函数/CTE：MyBatis</td></tr><tr><td>性能可观测性</td><td>需额外关注隐式 SQL、N+1</td><td>SQL 显式可见</td><td>强调可观测与调优：MyBatis</td></tr><tr><td>事务模型</td><td>与 Spring <code>@Transactional</code> 深度融合</td><td>同样可用 Spring 事务</td><td>两者都行，关键是边界规范</td></tr><tr><td>架构耦合</td><td>容易把 Entity 暴露到业务层</td><td>天然偏“防腐层”思想</td><td>DDD 场景更容易守住边界</td></tr><tr><td>团队维护成本</td><td>快，但要有 ORM 经验防坑</td><td>稳，但 SQL 规范必须统一</td><td>按团队基因选择，不要盲目“统一”</td></tr></tbody></table><hr><h2 id="_3-四组代码示例-最关键" tabindex="-1"><a class="header-anchor" href="#_3-四组代码示例-最关键"><span>3. 四组代码示例（最关键）</span></a></h2><blockquote><p>下面示例是教学代码，重点看“表达方式差异”。</p></blockquote><h3 id="_3-1-场景-a-动态条件查询" tabindex="-1"><a class="header-anchor" href="#_3-1-场景-a-动态条件查询"><span>3.1 场景 A：动态条件查询</span></a></h3><h4 id="mybatis-xml-动态-sql" tabindex="-1"><a class="header-anchor" href="#mybatis-xml-动态-sql"><span>MyBatis（XML 动态 SQL）</span></a></h4><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">select</span><span class="space"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;findByCondition&quot;</span><span class="space"> </span><span style="color:#D19A66;">resultType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;WarningStrategyDO&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">SELECT</span><span class="space"> </span><span style="color:#ABB2BF;">*</span><span class="space"> </span><span style="color:#ABB2BF;">FROM</span><span class="space"> </span><span style="color:#ABB2BF;">gsmm_warning_strategy</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">where</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">if</span><span class="space"> </span><span style="color:#D19A66;">test</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;treeId</span><span class="space"> </span><span style="color:#98C379;">!=</span><span class="space"> </span><span style="color:#98C379;">null</span><span class="space"> </span><span style="color:#98C379;">and</span><span class="space"> </span><span style="color:#98C379;">treeId</span><span class="space"> </span><span style="color:#98C379;">!=</span><span class="space"> </span><span style="color:#98C379;">&#39;&#39;&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">AND</span><span class="space"> </span><span style="color:#ABB2BF;">tree_id</span><span class="space"> </span><span style="color:#ABB2BF;">=</span><span class="space"> </span><span style="color:#ABB2BF;">#{treeId}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">if</span><span class="space"> </span><span style="color:#D19A66;">test</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;eventType</span><span class="space"> </span><span style="color:#98C379;">!=</span><span class="space"> </span><span style="color:#98C379;">null</span><span class="space"> </span><span style="color:#98C379;">and</span><span class="space"> </span><span style="color:#98C379;">eventType</span><span class="space"> </span><span style="color:#98C379;">!=</span><span class="space"> </span><span style="color:#98C379;">&#39;&#39;&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">AND</span><span class="space"> </span><span style="color:#ABB2BF;">event_type</span><span class="space"> </span><span style="color:#ABB2BF;">=</span><span class="space"> </span><span style="color:#ABB2BF;">#{eventType}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">AND</span><span class="space"> </span><span style="color:#ABB2BF;">is_deleted</span><span class="space"> </span><span style="color:#ABB2BF;">=</span><span class="space"> </span><span style="color:#ABB2BF;">false</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">where</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jpa-specification" tabindex="-1"><a class="header-anchor" href="#jpa-specification"><span>JPA（Specification）</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#C678DD;">interface</span><span class="space"> </span><span style="color:#E5C07B;">WarningStrategyRepository</span><span class="space"> </span><span style="color:#C678DD;">extends</span><span class="space"> </span><span style="color:#E5C07B;">JpaRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">WarningStrategyEntity</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">&gt;,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">JpaSpecificationExecutor</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">WarningStrategyEntity</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#C678DD;">static</span><span class="space"> </span><span style="color:#E5C07B;">Specification</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">WarningStrategyEntity</span><span style="color:#56B6C2;">&gt;</span><span class="space"> </span><span style="color:#61AFEF;">byCondition</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;">treeId</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;">eventType)</span><span class="space"> </span><span style="color:#E06C75;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">return</span><span class="space"> </span><span style="color:#E06C75;">(root</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#E06C75;">query</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#E06C75;">cb)</span><span class="space"> </span><span style="color:#C678DD;">-&gt;</span><span class="space"> </span><span style="color:#E06C75;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Predicate</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#E06C75;">predicates</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#C678DD;">new</span><span class="space"> </span><span style="color:#E5C07B;">ArrayList</span><span style="color:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">if</span><span class="space"> </span><span style="color:#E06C75;">(treeId</span><span class="space"> </span><span style="color:#56B6C2;">!=</span><span class="space"> </span><span style="color:#D19A66;">null</span><span class="space"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span class="space"> </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">treeId</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isBlank</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;">)</span><span class="space"> </span><span style="color:#E06C75;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">predicates</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">cb</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">equal</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">root</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;treeId&quot;</span><span style="color:#ABB2BF;">),</span><span class="space"> </span><span style="color:#ABB2BF;">treeId));</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">if</span><span class="space"> </span><span style="color:#E06C75;">(eventType</span><span class="space"> </span><span style="color:#56B6C2;">!=</span><span class="space"> </span><span style="color:#D19A66;">null</span><span class="space"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span class="space"> </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">eventType</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isBlank</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;">)</span><span class="space"> </span><span style="color:#E06C75;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">predicates</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">cb</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">equal</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">root</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;eventType&quot;</span><span style="color:#ABB2BF;">),</span><span class="space"> </span><span style="color:#ABB2BF;">eventType));</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">predicates</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">cb</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isFalse</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">root</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;isDeleted&quot;</span><span style="color:#ABB2BF;">)));</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">return</span><span class="space"> </span><span style="color:#E5C07B;">cb</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">and</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">predicates</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toArray</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Predicate</span><span style="color:#ABB2BF;">[]</span><span style="color:#C678DD;">::new</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75;">}</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>教学点评</strong>：</p><ul><li>MyBatis 更像“拼 SQL 句子”；</li><li>JPA 更像“拼查询对象”；</li><li>简单场景都好用，但复杂条件下 MyBatis 调试通常更直接。</li></ul><hr><h3 id="_3-2-场景-b-复杂报表-cte-聚合" tabindex="-1"><a class="header-anchor" href="#_3-2-场景-b-复杂报表-cte-聚合"><span>3.2 场景 B：复杂报表（CTE + 聚合）</span></a></h3><h4 id="mybatis" tabindex="-1"><a class="header-anchor" href="#mybatis"><span>MyBatis</span></a></h4><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">select</span><span class="space"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;selectMonthlyWarningStats&quot;</span><span class="space"> </span><span style="color:#D19A66;">resultType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;MonthlyWarningStatsDTO&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">WITH</span><span class="space"> </span><span style="color:#ABB2BF;">sub_regions</span><span class="space"> </span><span style="color:#ABB2BF;">AS</span><span class="space"> </span><span style="color:#ABB2BF;">(...),</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">monthly_warnings</span><span class="space"> </span><span style="color:#ABB2BF;">AS</span><span class="space"> </span><span style="color:#ABB2BF;">(...),</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">detailed_data</span><span class="space"> </span><span style="color:#ABB2BF;">AS</span><span class="space"> </span><span style="color:#ABB2BF;">(...)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">SELECT</span><span class="space"> </span><span style="color:#ABB2BF;">...</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">UNION</span><span class="space"> </span><span style="color:#ABB2BF;">ALL</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">SELECT</span><span class="space"> </span><span style="color:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jpa-一般会用原生-sql" tabindex="-1"><a class="header-anchor" href="#jpa-一般会用原生-sql"><span>JPA（一般会用原生 SQL）</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#C678DD;">interface</span><span class="space"> </span><span style="color:#E5C07B;">FoWarningInfoRepository</span><span class="space"> </span><span style="color:#C678DD;">extends</span><span class="space"> </span><span style="color:#E5C07B;">Repository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">FoWarningInfoEntity</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">interface</span><span class="space"> </span><span style="color:#E5C07B;">MonthlyWarningProjection</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#61AFEF;">getXzqDm</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#61AFEF;">getCityName</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">Long</span><span class="space"> </span><span style="color:#61AFEF;">getTotalCount</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">Long</span><span class="space"> </span><span style="color:#61AFEF;">getDisposedCount</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">BigDecimal</span><span class="space"> </span><span style="color:#61AFEF;">getDisposalRate</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Query</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">value</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379;">WITH</span><span class="space"> </span><span style="color:#98C379;">sub_regions</span><span class="space"> </span><span style="color:#98C379;">AS</span><span class="space"> </span><span style="color:#98C379;">(...),</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379;">monthly_warnings</span><span class="space"> </span><span style="color:#98C379;">AS</span><span class="space"> </span><span style="color:#98C379;">(...)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379;">SELECT</span><span class="space"> </span><span style="color:#98C379;">...</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379;">&quot;&quot;&quot;</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#D19A66;">nativeQuery</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#D19A66;">true</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">MonthlyWarningProjection</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#61AFEF;">selectMonthlyWarningStats</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Param</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;xzqDm&quot;</span><span style="color:#ABB2BF;">)</span><span class="space"> </span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;font-style:italic;">xzqDm</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Param</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;eventType&quot;</span><span style="color:#ABB2BF;">)</span><span class="space"> </span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;font-style:italic;">eventType</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>教学点评</strong>：</p><ul><li>这类查询 JPA 最终也常常“回到 SQL”。</li><li>如果你的核心价值在复杂查询，MyBatis 的心智模型更稳。</li></ul><hr><h3 id="_3-3-场景-c-postgresql-jsonb-字段映射" tabindex="-1"><a class="header-anchor" href="#_3-3-场景-c-postgresql-jsonb-字段映射"><span>3.3 场景 C：PostgreSQL <code>jsonb</code> 字段映射</span></a></h3><h4 id="mybatis-typehandler" tabindex="-1"><a class="header-anchor" href="#mybatis-typehandler"><span>MyBatis（TypeHandler）</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">TableField</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">value</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#98C379;">&quot;original_image&quot;</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#D19A66;">typeHandler</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#E5C07B;">JsonbTypeHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">private</span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#E06C75;">originalImage</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">#{condition.originalImage,</span><span class="space"> </span><span style="color:#ABB2BF;">jdbcType=OTHER}::jsonb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="jpa-hibernate-6-示例" tabindex="-1"><a class="header-anchor" href="#jpa-hibernate-6-示例"><span>JPA（Hibernate 6 示例）</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Entity</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Table</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#98C379;">&quot;gsmm_warning_info&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#C678DD;">class</span><span class="space"> </span><span style="color:#E5C07B;">WarningEntity</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Id</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">private</span><span class="space"> </span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;">id</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">JdbcTypeCode</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">SqlTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">JSON</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#98C379;">&quot;original_image&quot;</span><span style="color:#ABB2BF;">,</span><span class="space"> </span><span style="color:#D19A66;">columnDefinition</span><span class="space"> </span><span style="color:#56B6C2;">=</span><span class="space"> </span><span style="color:#98C379;">&quot;jsonb&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">private</span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#E06C75;">originalImage</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>教学点评</strong>：</p><ul><li>两者都能做，但 MyBatis 对方言控制更“显式”。</li><li>如果你大量使用数据库特性，MyBatis 更少“黑盒感”。</li></ul><hr><h3 id="_3-4-场景-d-ddd-分层下如何防止-orm-污染领域" tabindex="-1"><a class="header-anchor" href="#_3-4-场景-d-ddd-分层下如何防止-orm-污染领域"><span>3.4 场景 D：DDD 分层下如何防止 ORM 污染领域</span></a></h3><p>无论你选 JPA 还是 MyBatis，都建议：</p><ul><li><code>domain</code> 层定义 <code>Gateway</code> 接口；</li><li><code>infrastructure</code> 层实现具体持久化；</li><li>不让 Entity/DO 直接泄漏到应用层与领域层。</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">domain</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#C678DD;">interface</span><span class="space"> </span><span style="color:#E5C07B;">WarningStrategyGateway</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">WarningStrategy</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#61AFEF;">findByTreeId</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;font-style:italic;">treeId</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">infrastructure</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">(JPA</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">or</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">MyBatis</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">都可以是实现细节)</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Service</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RequiredArgsConstructor</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#C678DD;">class</span><span class="space"> </span><span style="color:#E5C07B;">WarningStrategyGatewayImpl</span><span class="space"> </span><span style="color:#C678DD;">implements</span><span class="space"> </span><span style="color:#E5C07B;">WarningStrategyGateway</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">public</span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">WarningStrategy</span><span style="color:#ABB2BF;">&gt;</span><span class="space"> </span><span style="color:#61AFEF;">findByTreeId</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span class="space"> </span><span style="color:#E06C75;font-style:italic;">treeId</span><span style="color:#ABB2BF;">)</span><span class="space"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">//</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">查询</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">+</span><span class="space"> </span><span style="color:#7F848E;font-style:italic;">转换</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD;">return</span><span class="space"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">of</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>教学点评</strong>：</p><ul><li>架构边界比 ORM 选择更重要。</li><li>好边界可以让你将来低风险替换持久化方案。</li></ul><hr><h2 id="_4-常见误区-面试和实战高频" tabindex="-1"><a class="header-anchor" href="#_4-常见误区-面试和实战高频"><span>4. 常见误区（面试和实战高频）</span></a></h2><h3 id="误区-1-jpa-一定比-mybatis-慢" tabindex="-1"><a class="header-anchor" href="#误区-1-jpa-一定比-mybatis-慢"><span>误区 1：JPA 一定比 MyBatis 慢</span></a></h3><p>不绝对。慢的通常是“错误使用方式”，如 N+1、过度懒加载、无索引。</p><h3 id="误区-2-mybatis-一定更难维护" tabindex="-1"><a class="header-anchor" href="#误区-2-mybatis-一定更难维护"><span>误区 2：MyBatis 一定更难维护</span></a></h3><p>也不绝对。若 SQL 规范、分层、命名统一，维护性可以很好。</p><h3 id="误区-3-全项目必须统一一种技术" tabindex="-1"><a class="header-anchor" href="#误区-3-全项目必须统一一种技术"><span>误区 3：全项目必须统一一种技术</span></a></h3><p>真实工程里，<strong>按场景混用</strong>往往是最优解。</p><h3 id="误区-4-选了-jpa-就不写-sql" tabindex="-1"><a class="header-anchor" href="#误区-4-选了-jpa-就不写-sql"><span>误区 4：选了 JPA 就不写 SQL</span></a></h3><p>复杂查询、统计报表、方言特性场景，JPA 也常要写原生 SQL。</p><hr><h2 id="_5-一套可执行的选型清单-建议收藏" tabindex="-1"><a class="header-anchor" href="#_5-一套可执行的选型清单-建议收藏"><span>5. 一套可执行的选型清单（建议收藏）</span></a></h2><p>你可以逐条打勾：</p><ul><li>是否有大量复杂 SQL / 报表 / CTE / <code>jsonb</code>？</li><li>是否需要精细控制 SQL 与执行计划？</li><li>团队是否更擅长 SQL 还是 ORM？</li><li>业务模型是否稳定、主要是 CRUD？</li><li>是否允许一部分模块先试点，再逐步推广？</li></ul><p><strong>决策模板</strong>：</p><ul><li>复杂查询模块：MyBatis（可配 MyBatis-Plus 提升 CRUD 效率）</li><li>标准 CRUD 模块：JPA</li><li>统一边界：都走 Gateway，避免技术细节外泄</li></ul><hr><h2 id="_6-给团队的渐进式落地策略" tabindex="-1"><a class="header-anchor" href="#_6-给团队的渐进式落地策略"><span>6. 给团队的渐进式落地策略</span></a></h2><h3 id="第一步-先定边界-再定框架" tabindex="-1"><a class="header-anchor" href="#第一步-先定边界-再定框架"><span>第一步：先定边界，再定框架</span></a></h3><ul><li>先统一 DTO / Domain / Gateway 边界。</li><li>再决定每个模块用 JPA 还是 MyBatis。</li></ul><h3 id="第二步-从新增模块试点" tabindex="-1"><a class="header-anchor" href="#第二步-从新增模块试点"><span>第二步：从新增模块试点</span></a></h3><ul><li>不要立刻重构全量历史代码。</li><li>新模块按“复杂度”选型，积累真实数据。</li></ul><h3 id="第三步-建立治理规则" tabindex="-1"><a class="header-anchor" href="#第三步-建立治理规则"><span>第三步：建立治理规则</span></a></h3><ul><li>JPA：禁止无脑 <code>EAGER</code>，关注 N+1。</li><li>MyBatis：统一 SQL 命名与分页规范，沉淀复用片段。</li></ul><h3 id="第四步-用指标说话" tabindex="-1"><a class="header-anchor" href="#第四步-用指标说话"><span>第四步：用指标说话</span></a></h3><ul><li>对比开发效率、接口 RT、慢 SQL、故障率。</li><li>每月复盘一次，动态调整策略。</li></ul><hr><h2 id="_7-结语" tabindex="-1"><a class="header-anchor" href="#_7-结语"><span>7. 结语</span></a></h2><p>JPA 和 MyBatis 不是对立关系，而是工具箱里的两把扳手。</p><ul><li>你要的是<strong>更快交付</strong>，就让简单场景更快（JPA）。</li><li>你要的是<strong>更强可控</strong>，就让复杂场景更稳（MyBatis）。</li><li>真正的工程能力，是“按场景选工具 + 用架构隔离变化”。</li></ul><hr><h2 id="参考资料-官方" tabindex="-1"><a class="header-anchor" href="#参考资料-官方"><span>参考资料（官方）</span></a></h2><ul><li>Spring Data JPA 文档： <ul><li><a href="https://github.com/spring-projects/spring-data-jpa/blob/main/src/main/antora/modules/ROOT/pages/jpa/query-methods.adoc" target="_blank" rel="noopener noreferrer">https://github.com/spring-projects/spring-data-jpa/blob/main/src/main/antora/modules/ROOT/pages/jpa/query-methods.adoc</a></li></ul></li><li>MyBatis 动态 SQL： <ul><li><a href="https://github.com/mybatis/mybatis-3/blob/master/src/site/markdown/dynamic-sql.md" target="_blank" rel="noopener noreferrer">https://github.com/mybatis/mybatis-3/blob/master/src/site/markdown/dynamic-sql.md</a></li></ul></li><li>MyBatis-Plus 文档： <ul><li><a href="https://github.com/baomidou/mybatis-plus-doc" target="_blank" rel="noopener noreferrer">https://github.com/baomidou/mybatis-plus-doc</a></li></ul></li></ul></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-48823583 data-v-9110afba><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-9110afba><span class="contributors-label" data-v-9110afba>贡献者: </span><span class="contributors-info" data-v-9110afba><!--[--><!--[--><span class="contributor" data-v-9110afba>金逸霄</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-9110afba><div class="pager" data-v-9110afba><a class="vp-link no-icon link pager-link prev" href="/article/3bw3zehx/" data-v-9110afba data-v-8fd51d7e><!--[--><span class="desc" data-v-9110afba>上一页</span><span class="title" data-v-9110afba>从贫血模型到充血模型</span><!--]--><!----></a></div><div class="pager" data-v-9110afba><a class="vp-link no-icon link pager-link next" href="/article/n1khzto6/" data-v-9110afba data-v-8fd51d7e><!--[--><span class="desc" data-v-9110afba>下一页</span><span class="title" data-v-9110afba>ddd-architecture-blog</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-3bf3774b style="display:none;" data-v-22e14b5d><span class="percent" data-allow-mismatch data-v-22e14b5d>0%</span><span class="show icon vpi-back-to-top" data-v-22e14b5d></span><svg aria-hidden="true" data-v-22e14b5d><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-22e14b5d></circle></svg></button><footer class="vp-footer" vp-footer data-v-3bf3774b data-v-232bff92><!--[--><div class="container" data-v-232bff92><p class="message" data-v-232bff92>————————到底啦!————————</p><p class="copyright" data-v-232bff92>copyleft © 2025 Exiao</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-pBrtxVLr.js" defer></script></body></html>