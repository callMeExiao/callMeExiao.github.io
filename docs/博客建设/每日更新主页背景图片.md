---
title: æ¯æ—¥æ›´æ–°ä¸»é¡µèƒŒæ™¯å›¾ç‰‡
createTime: 2025/03/10 15:21:58
permalink: /article/daily-update-home-background/
description: ä½¿ç”¨GitHub Actionå’ŒJavaå®ç°æ¯æ—¥ä¸‹è½½bingå›¾ç‰‡æ›´æ–°ä¸»é¡µèƒŒæ™¯ï¼Œä»¥è¾¾åˆ°åŠ å¿«è®¿é—®åšå®¢ä¸»é¡µçš„æ•ˆæœ
tags:
  - GitHub Action
  - Java
keywords:
  - GitHub Actionå®šæ—¶è„šæœ¬
  - Javaè·å–bingå›¾ç‰‡
---

# ä½¿ç”¨ GitHub Actions è‡ªåŠ¨æ›´æ–°å¿…åº”æ¯æ—¥å£çº¸

æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨ GitHub Actions è‡ªåŠ¨è·å–å¿…åº”æ¯æ—¥å£çº¸ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºåšå®¢çš„èƒŒæ™¯å›¾ç‰‡ã€‚

## 1. é¡¹ç›®ç»“æ„

ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. Java ç¨‹åºï¼šè´Ÿè´£è·å–å’Œå¤„ç†å¿…åº”å£çº¸
2. GitHub Actions é…ç½®ï¼šè´Ÿè´£å®šæ—¶æ‰§è¡Œç¨‹åº
3. ç½‘ç«™é…ç½®ï¼šå±•ç¤ºèƒŒæ™¯å›¾ç‰‡

## 2. Java ç¨‹åºå®ç°

### 2.1 ä¾èµ–é…ç½®

åœ¨ <mcfile name="pom.xml" path="f:\Codes\Projects\callMeExiao.github.io\pom.xml"></mcfile> ä¸­æ·»åŠ æ‰€éœ€ä¾èµ–ï¼š

```xml

<dependencies>
    <!-- HTTPå®¢æˆ·ç«¯ -->
    <dependency>
        <groupId>org.apache.httpcomponents</groupId>
        <artifactId>httpclient</artifactId>
        <version>4.5.13</version>
    </dependency>
    <!-- JSONå¤„ç† -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
        <version>2.13.4.1</version>
    </dependency>
    <!-- æ—¥å¿— -->
    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-api</artifactId>
        <version>1.7.36</version>
    </dependency>
    <dependency>
        <groupId>ch.qos.logback</groupId>
        <artifactId>logback-classic</artifactId>
        <version>1.2.11</version>
    </dependency>
</dependencies>
```

### 2.2 æ ¸å¿ƒä»£ç å®ç°

ä¸»è¦å®ç°åœ¨ `BingWallpaperApp.java` ä¸­ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

1. è°ƒç”¨å¿…åº”å£çº¸ API è·å–æ¯æ—¥å›¾ç‰‡ä¿¡æ¯
2. ä¸‹è½½å£çº¸å›¾ç‰‡åˆ°æŒ‡å®šç›®å½•
3. æ›´æ–°å£çº¸ç›¸å…³æ•°æ®

æ ¸å¿ƒæ–¹æ³•è¯´æ˜ï¼š

- `fetchBingData` ï¼šè·å–å¿…åº” API æ•°æ®
- `downloadImage` ï¼šä¸‹è½½å£çº¸å›¾ç‰‡
- `updateWallpaperData` ï¼šæ›´æ–°å£çº¸æ•°æ®æ–‡ä»¶

```java
public class BingWallpaperApp {
    private static final Logger logger = LoggerFactory.getLogger(BingWallpaperApp.class);
    private static final String BING_API_URL = "https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=zh-CN";
    private static final String BING_BASE_URL = "https://www.bing.com";
    private static final String IMAGES_DIR = "docs/.vuepress/public/images";
    private static final String WALLPAPER_DATA_FILE = "docs/.vuepress/public/data/bing-wallpaper.json";

    public static void main(String[] args) {
        try {
            logger.info("å¼€å§‹æ‰§è¡ŒBingå£çº¸æ›´æ–°ä»»åŠ¡");

            // ç¡®ä¿ç›®å½•å­˜åœ¨
            createDirectoryIfNotExists(IMAGES_DIR);
            createDirectoryIfNotExists(Paths.get(WALLPAPER_DATA_FILE).getParent().toString());

            // è·å–Bingå£çº¸ä¿¡æ¯
            String bingData = fetchBingData();
            ObjectMapper mapper = new ObjectMapper();
            JsonNode rootNode = mapper.readTree(bingData);

            // è§£æå£çº¸æ•°æ®
            JsonNode imageNode = rootNode.path("images").get(0);
            String imageUrl = BING_BASE_URL + imageNode.path("url").asText();
            String copyright = imageNode.path("copyright").asText();
            String date = new SimpleDateFormat("yyyy-MM-dd").format(new Date());

            // ä¸‹è½½å£çº¸
            String fileName = "bingWallpaper.jpg";
            String localPath = IMAGES_DIR + "/" + fileName;
            downloadImage(imageUrl, localPath);

            // æ›´æ–°æ•°æ®æ–‡ä»¶
            updateWallpaperData(date, copyright, fileName);

            logger.info("Bingå£çº¸æ›´æ–°ä»»åŠ¡å®Œæˆ");
        } catch (Exception e) {
            logger.error("æ‰§è¡ŒBingå£çº¸æ›´æ–°ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯", e);
            System.exit(1);
        }
    }

    private static String fetchBingData() throws IOException {
        try (CloseableHttpClient httpClient = HttpClients.createDefault()) {
            HttpGet request = new HttpGet(BING_API_URL);
            try (CloseableHttpResponse response = httpClient.execute(request)) {
                return EntityUtils.toString(response.getEntity());
            }
        }
    }

    private static void downloadImage(String imageUrl, String localPath) throws IOException {
        try (CloseableHttpClient httpClient = HttpClients.createDefault()) {
            HttpGet request = new HttpGet(imageUrl);
            try (CloseableHttpResponse response = httpClient.execute(request);
                 InputStream inputStream = response.getEntity().getContent();
                 FileOutputStream outputStream = new FileOutputStream(localPath)) {

                byte[] buffer = new byte[4096];
                int bytesRead;
                while ((bytesRead = inputStream.read(buffer)) != -1) {
                    outputStream.write(buffer, 0, bytesRead);
                }

                logger.info("å£çº¸å·²ä¸‹è½½åˆ°: {}", localPath);
            }
        }
    }

    private static void updateWallpaperData(String date, String copyright, String fileName) throws IOException {
        File dataFile = new File(WALLPAPER_DATA_FILE);
        ObjectMapper mapper = new ObjectMapper();

        JsonNode rootNode;
        if (dataFile.exists()) {
            rootNode = mapper.readTree(dataFile);
        } else {
            rootNode = mapper.createObjectNode();
        }

        ((com.fasterxml.jackson.databind.node.ObjectNode) rootNode).put("lastUpdate", date);
        ((com.fasterxml.jackson.databind.node.ObjectNode) rootNode).put("copyright", copyright);
        ((com.fasterxml.jackson.databind.node.ObjectNode) rootNode).put("image", "images/bing/" + fileName);

        mapper.writerWithDefaultPrettyPrinter().writeValue(dataFile, rootNode);
        logger.info("å£çº¸æ•°æ®å·²æ›´æ–°");
    }

    private static void createDirectoryIfNotExists(String dirPath) throws IOException {
        Path path = Paths.get(dirPath);
        if (!Files.exists(path)) {
            Files.createDirectories(path);
            logger.info("åˆ›å»ºç›®å½•: {}", dirPath);
        }
    }
}
```

### 2.3æ‰“åŒ…é…ç½®

ä¸ºäº†èƒ½åœ¨ GitHub Actions ä¸­è¿è¡Œï¼Œéœ€è¦å°†ç¨‹åºæ‰“åŒ…æˆå¯æ‰§è¡Œ jar åŒ…ã€‚åœ¨ pom.xml ä¸­æ·»åŠ æ‰“åŒ…æ’ä»¶ï¼š

```xml

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-assembly-plugin</artifactId>
            <version>3.1.0</version>
            <configuration>
                <archive>
                    <manifest>
                        <mainClass>com.exiao.BingWallpaperApp</mainClass>
                    </manifest>
                </archive>
                <descriptorRefs>
                    <descriptorRef>jar-with-dependencies</descriptorRef>
                </descriptorRefs>
                <finalName>${project.name}</finalName>
            </configuration>
            <executions>
                <execution>
                    <id>make-assembly</id>
                    <phase>package</phase>
                    <goals>
                        <goal>single</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

## 3. GitHub Actions é…ç½®

åˆ›å»º .github/workflows/update-bing-wallpaper.yml æ–‡ä»¶ï¼Œé…ç½®å®šæ—¶ä»»åŠ¡ï¼š

```yml
name: Update Bing Wallpaper

on:
  push:
    # å½“ main åˆ†æ”¯æ¥æ”¶åˆ°æ¨é€æ—¶è§¦å‘
    branches: [ main ]
  schedule:
    # å®šæ—¶ä»»åŠ¡ï¼ˆUTC æ—¶é—´æ¯å¤© 0 ç‚¹ï¼ŒåŒ—äº¬æ—¶é—´ 8 ç‚¹ï¼‰
    - cron: '0 0 * * *'

jobs:
  build:
    # ä½¿ç”¨æœ€æ–°ç‰ˆ Ubuntu è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    steps:
      # æ£€å‡ºä»£ç ä»“åº“
      - uses: actions/checkout@v2
      # è®¾ç½® JDK 8 ç¯å¢ƒ
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      # è¾“å‡ºå½“å‰æ—¶é—´ï¼ˆç”¨äºæ—¥å¿—è®°å½•ï¼‰
      - name: current date
        run: date
      # Maven æ‰“åŒ…é¡¹ç›®
      - name: Build with Maven
        run: mvn -B package --file pom.xml
      # è¿è¡Œ Java ç¨‹åºç”Ÿæˆå£çº¸
      - name: Run Java Application
        run: java -jar target/bing-wallpaper-jar-with-dependencies.jar
      # æäº¤å˜æ›´æ–‡ä»¶ï¼ˆå£çº¸å›¾ç‰‡ï¼‰
      - name: Commit files
        run: |
          git config --local user.email "574355578@qq.com"
          git config --local user.name "My Github Actions"
          git add -A  # ç®€åŒ–æ·»åŠ æ‰€æœ‰å˜æ›´æ–‡ä»¶
          git commit -m "chore: æ—¥å¸¸æ›´æ–°bingå£çº¸" || echo "æ²¡æœ‰æ–°å˜æ›´éœ€è¦æäº¤"
          git pull --rebase  # æ·»åŠ  rebase é¿å…åˆå¹¶æäº¤
      # æ¨é€å˜æ›´åˆ° main åˆ†æ”¯
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          # github_token æ˜¯ GitHub Actions è‡ªåŠ¨ç”Ÿæˆçš„è®¤è¯ä»¤ç‰Œï¼Œä¸»è¦ç”¨äºï¼š
          # èº«ä»½éªŒè¯ - å…è®¸å·¥ä½œæµå‘ä»“åº“æ¨é€ä»£ç å˜æ›´
          # æƒé™æ§åˆ¶ - è‡ªåŠ¨æ‹¥æœ‰å½“å‰ä»“åº“çš„è¯»å†™æƒé™ï¼ˆä½†ä»…é™äºå½“å‰ä»“åº“ï¼‰
          # å®‰å…¨æ€§ - ç”± GitHub è‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®æ•æ„Ÿä¿¡æ¯
          # åœ¨https://github.com/settings/tokensè®¾ç½®ä¸€ä¸ªPersonal access tokens (classic)
          # å°†è¿™ä¸ªtokenè®¾ç½®åˆ°ä»“åº“çš„settings/secrets/actions
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
```

åŒæ—¶éœ€è¦é…ç½®å¦ä¸€ä¸ªworkflowï¼Œç”¨äºåœ¨update-bing-wallpaper.ymlå®Œæˆåè§¦å‘éƒ¨ç½²ï¼Œ
è€Œè¿™ä¸ªworkflowä¸»è¦è´Ÿè´£æ”¶åˆ°pushåçš„è‡ªåŠ¨éƒ¨ç½²ï¼š

```yml
name: deploy

on:
  # æ·»åŠ  workflow_run è§¦å‘å™¨
  workflow_run:
    workflows: [ "Update Bing Wallpaper" ]
    branches: [ main ]
    types:
      - completed
  # æ¯å½“ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘éƒ¨ç½²
  push:
    branches: [ main ]
    paths-ignore: # æ·»åŠ è·¯å¾„è¿‡æ»¤
      - 'docs/å£çº¸/**'
      - 'target/**'
  # æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
  workflow_dispatch:

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          # â€œæœ€è¿‘æ›´æ–°æ—¶é—´â€ ç­‰ git æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‹‰å–å…¨éƒ¨æäº¤è®°å½•
          fetch-depth: 0

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          # é€‰æ‹©è¦ä½¿ç”¨çš„ pnpm ç‰ˆæœ¬
          version: 8
          # ä½¿ç”¨ pnpm å®‰è£…ä¾èµ–
          run_install: true

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          # é€‰æ‹©è¦ä½¿ç”¨çš„ node ç‰ˆæœ¬
          node-version: 20
          # ç¼“å­˜ pnpm ä¾èµ–
          cache: pnpm

      # è¿è¡Œæ„å»ºè„šæœ¬
      - name: Build VuePress site
        run: pnpm docs:build

      # è¿è¡Œæ„å»ºè„šæœ¬
      - name: Build VuePress site
        run: npm run docs:build

      # æŸ¥çœ‹ workflow çš„æ–‡æ¡£æ¥è·å–æ›´å¤šä¿¡æ¯
      # @see https://github.com/crazy-max/ghaction-github-pages
      - name: Deploy to GitHub Pages
        uses: crazy-max/ghaction-github-pages@v4
        with:
          # éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
          target_branch: gh-pages
          # éƒ¨ç½²ç›®å½•ä¸º VuePress çš„é»˜è®¤è¾“å‡ºç›®å½•
          build_dir: docs/.vuepress/dist
        env:
          # @see https://docs.github.com/cn/actions/reference/authentication-in-a-workflow#about-the-github_token-secret
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## 4. æ•°æ®ç»“æ„

ç¨‹åºä¼šç”Ÿæˆä¸¤ä¸ªä¸»è¦æ–‡ä»¶ï¼š

1. å£çº¸å›¾ç‰‡ï¼š docs/.vuepress/public/images/bing/bingWallpaper.jpg
2. å£çº¸æ•°æ®ï¼š docs/.vuepress/public/data/bing-wallpaper.json

```json
{
  "lastUpdate": "2024-03-10",
  "copyright": "å›¾ç‰‡ç‰ˆæƒä¿¡æ¯",
  "image": "images/bing/bingWallpaper.jpg"
}
```

## 5. ç½‘ç«™é…ç½®

ä¸»è¦å®ç°åœ¨ `HomeBanner.vue` ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š

```vue

<template>
  <div class="home-banner" :style="bannerStyle">
    <div class="banner-content">
      <div class="avatar-container">
        <img class="avatar" :src="avatarUrl" alt="Exiao's Avatar" />
      </div>
      <h1 class="banner-text" style="font-size: 26px">ğŸæ¬¢è¿æ¥åˆ°éœ„éœ„çš„æŠ€æœ¯åšå®¢~å‘€å‘¼~</h1>
    </div>
  </div>
</template>

<script setup>
  import {ref, onMounted} from 'vue'

  // èƒŒæ™¯å›¾ç‰‡ URL
  const backgroundUrl = ref('')
  // ä½ çš„å¤´åƒ URLï¼Œè¯·æ›¿æ¢ä¸ºä½ çš„å®é™…å¤´åƒåœ°å€
  const avatarUrl = ref('/images/homeAvatar.jpg')

  // åˆ¤æ–­æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
  const isMobile = () => {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
        navigator.userAgent
    )
  }

  // èƒŒæ™¯æ ·å¼
  const bannerStyle = ref({
    backgroundImage: 'none',
    backgroundSize: 'cover',
    backgroundPosition: 'center'
  })

  // ä½¿ç”¨æœ¬åœ° Bing å£çº¸
  const useBingWallpaper = () => {
    try {
      // ç›´æ¥ä½¿ç”¨æœ¬åœ°å£çº¸è·¯å¾„
      const imageUrl = '/images/bingWallpaper.jpg'
      backgroundUrl.value = imageUrl
      bannerStyle.value.backgroundImage = `url(${imageUrl})`
    } catch (error) {
      console.error('åŠ è½½æœ¬åœ°å£çº¸å‡ºé”™:', error)
      // ä½¿ç”¨é»˜è®¤èƒŒæ™¯å›¾
      bannerStyle.value.backgroundImage = 'url(/images/defaultHomeBanner.jpg)'
    }
  }

  onMounted(() => {
    useBingWallpaper()
  })
</script>

<style scoped>
  .home-banner {
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
  }

  .home-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.4);
    z-index: 1;
  }

  .banner-content {
    position: relative;
    z-index: 2;
    text-align: center;
    color: white;
    padding: 2rem;
  }

  .avatar-container {
    margin-bottom: 2rem;
  }

  .avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    object-fit: cover;
  }

  .banner-text {
    font-size: 2.5rem;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    margin: 0;
  }

  @media (max-width: 768px) {
    .avatar {
      width: 120px;
      height: 120px;
    }

    .banner-text {
      font-size: 1.8rem;
    }
  }
</style>
```